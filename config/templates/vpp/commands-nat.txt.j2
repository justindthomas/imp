# VPP NAT Instance Commands
# Generated by configure-router.py

# Memif to core (internal side)
create memif socket id 1 filename /run/vpp/memif-nat-int.sock
create interface memif id 0 socket-id 1 slave
set interface state memif1/0 up
set interface ip address memif1/0 169.254.1.5/31

# Memif to core (external side)
create memif socket id 2 filename /run/vpp/memif-nat-ext.sock
create interface memif id 0 socket-id 2 slave
set interface state memif2/0 up
set interface ip address memif2/0 169.254.1.6/31

# Enable deterministic NAT44
det44 plugin enable
set interface det44 inside memif1/0 outside memif2/0

# NAT pool mappings
{% for mapping in nat.mappings %}
det44 add in {{ mapping.source_network }} out {{ mapping.nat_pool }}
{% endfor %}

# Routes
ip route add 0.0.0.0/0 via 169.254.1.7 memif2/0
{% for mapping in nat.mappings %}
ip route add {{ mapping.source_network }} via 169.254.1.4 memif1/0
{% endfor %}
