# VPP Core Commands
# Generated by configure-router.sh

lcp lcp-sync on
lcp lcp-auto-subint on

# External interface
lcp create external host-if external
set interface state external up
{{EXTERNAL_IPV4_CMD}}
{{EXTERNAL_IPV6_CMD}}
set interface mtu 1500 external

# Internal interfaces
{{INTERNAL_INTERFACES_CONFIG}}

# Memif to NAT instance (internal side)
create memif socket id 1 filename /run/vpp/memif-nat-int.sock
create interface memif id 0 socket-id 1 master
set interface state memif1/0 up
set interface ip address memif1/0 169.254.1.4/31

# Memif to NAT instance (external side)
create memif socket id 2 filename /run/vpp/memif-nat-ext.sock
create interface memif id 0 socket-id 2 master
lcp create memif2/0 host-if memif2
set interface state memif2/0 up
set interface ip address memif2/0 169.254.1.7/31

# ACL-based forwarding to NAT for internal networks
{{ABF_ACLS}}

# Default routes
{{DEFAULT_ROUTE_IPV4}}
{{DEFAULT_ROUTE_IPV6}}

# Route for NAT pool (via NAT instance)
ip route add ${NAT_POOL} via 169.254.1.6 memif2/0
